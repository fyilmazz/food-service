<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/static/js/jquery-3.3.1.min.js"></script>
</head>
<body>
{% if not user.is_authenticated %}
    <a href="/login">Giriş yap</a>
    <a href="/signup">Kayıt ol</a>
{% else %}
    <a href="/logout">Çıkış yap</a>
    <h1>Sepet tutarı: {{ cart_total }}</h1>
    <button class="reset-cart">Sepeti sıfırla</button>
    <button class="give-order">Sipariş ver</button>
{% endif %}

{% for food in foods %}
    <u1>
        <li>{{ food.3 }}, {% if food.2 %} Açıklama: {{ food.2 }}, {% endif %} Fiyat: {{ food.1 }} </li>
        {% if user.is_authenticated %}
            <button class="add-to-cart" data-food-id="{{ food.0 }}">Sepete ekle</button>
        {% endif %}
    </u1>
{% endfor %}

{% if user.is_authenticated %}
    <h2>Geçmiş siparişler:</h2>
    <h3>Toplam harcama: {% if total_spend %} {{ total_spend }} {% else %} 0 {% endif %}</h3>
    {% for key, value in orders_dict.items %}
        <hr>
        <h3>Sipariş tarihi: {{ value.order_date }}, Sipariş tutarı: {{ value.total_price }}</h3>
        {% for food in value.foods %}
            <h4>{{ food }}</h4>
        {% endfor %}
        {% if value.review_comment %}
            <h3>Yorum: {{ value.review_comment }}, Rating: {{ value.review_rating }}</h3>
        {% else %}
            <form method="post" action="/">
                {% csrf_token %}
                <input type="hidden" name="order_id" value="{{ key }}">
                <input type="text" name="comment" placeholder="Yorum"/>
                <input type="number" min="0" max="10" step="1" name="rating" placeholder="Rating"/>
                <button type="submit">Yorum ekle</button>
            </form>
        {% endif %}
    {% endfor %}
{% endif %}

<script>
    $(document).ready(function() {
        $("button.add-to-cart").click(function(){
            var food_id = $(this).data('food-id');
            $.post("/",
                {
                    food_id: food_id,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                function(data, status){
                    if (status == 'success')
                        location.reload();
                });
        });

        $("button.reset-cart").click(function(){
            $.post("/",
                {
                    reset_cart: 1,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                function(data, status){
                    if (status == 'success')
                        location.reload();
                });
        });

        $("button.give-order").click(function(){
            $.post("/",
                {
                    give_order: 1,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                function(data, status){
                    if (status == 'success')
                        location.reload();
                });
        });
    });
</script>
</body>
</html>